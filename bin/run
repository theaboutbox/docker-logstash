#!/bin/bash

set -e
set -x

if [ -z "$LOGSTASH_CONFIG_FILE" ]; then
  LOGSTASH_CONFIG_FILE=/app/conf/logstash.default.conf
fi
CONFIG_FILE_NAME=`basename $LOGSTASH_CONFIG_FILE`
LOGSTASH_CONFIG_SUBST=/tmp/${CONFIG_FILE_NAME}.subst
cat $LOGSTASH_CONFIG_FILE | envsubst > $LOGSTASH_CONFIG_SUBST

# Fire up logstash!
exec /opt/logstash/bin/logstash \
     agent \
     --config $LOGSTASH_CONFIG_FILE \
     -- \
     web
